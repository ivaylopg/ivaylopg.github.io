function support(e){for(var t=0,r=e.length;t<r;t++)if("undefined"!=typeof el.style[e[t]])return e[t]}var el=document.createElement("div"),transformProps="transform WebkitTransform MozTransform OTransform msTransform".split(" "),transformProp=support(transformProps),Cube={startX:-20,startY:45,xRange:30,yRange:35,spinSpeed:.2,autoRotate:!1,viewport:{},viewCenter:{x:window.innerWidth/2,y:$("#theBlackBox").offset().top+$("#theBlackBox").height()/2}};Cube.viewport={posVector:new Vector2d(Cube.startX,Cube.startY),targVector:new Vector2d(Cube.startX,Cube.startY),speed:Cube.spinSpeed,el:$(".cube")[0],update:function(e){e&&"number"==typeof e.x&&"number"==typeof e.y&&(this.targVector.x=e.x.clamp(Cube.startX-Cube.xRange,Cube.startX+Cube.xRange),this.targVector.y=e.y.clamp(Cube.startY-Cube.yRange,Cube.startY+Cube.yRange))},move:function(){if(Cube.autoRotate)this.posVector.y+=Cube.spinSpeed/2;else{var e=new Vector2d(this.targVector.x-this.posVector.x,this.targVector.y-this.posVector.y);e.mag()>this.speed&&e.setMag(this.speed),this.posVector.add(e)}this.posVector.y>=Cube.startY+36e3&&(this.posVector.y=Cube.startY),this.el.style[transformProp]="rotateX("+this.posVector.x+"deg) rotateY("+this.posVector.y+"deg)"},reset:function(){this.update({x:Cube.startX,y:Cube.startY})}},Cube.resize=function(e){if(0===e)$(".cube").removeAttr("style"),$(".cube div").removeAttr("style"),$(".cube")[0].style[transformProp]="rotateX("+Cube.viewport.posVector.x+"deg) rotateY("+Cube.viewport.posVector.y+"deg)";else{var t=e/500;t.clamp(.75,1),$(".cube").css({height:400*t+"px",width:400*t+"px"}),$(".cube > div").css({height:360*t+"px",width:360*t+"px",padding:20*t+"px"}),$(".cube > div:first-child")[0].style[transformProp]="rotateX(90deg) translateZ("+200*t+"px)",$(".cube > div:nth-child(2)")[0].style[transformProp]="translateZ("+200*t+"px)",$(".cube > div:nth-child(3)")[0].style[transformProp]="rotateY(90deg) translateZ("+200*t+"px)",$(".cube > div:nth-child(4)")[0].style[transformProp]="rotateY(180deg) translateZ("+200*t+"px)",$(".cube > div:nth-child(5)")[0].style[transformProp]="rotateY(-90deg) translateZ("+200*t+"px)",$(".cube > div:nth-child(6)")[0].style[transformProp]="rotateX(-90deg) rotate(180deg) translateZ("+200*t+"px)"}},$("#theBlackBox").mouseenter(function(e){$(document).on("mousemove",function(e){e.preventDefault(),$("#theBlackBox").trigger("move-viewport",{x:e.pageX,y:e.pageY})})}),$("#theBlackBox").mouseleave(function(e){Cube.viewport.reset(),$(document).off("mousemove")}),$("#theBlackBox").on("move-viewport",function(e,t){var r=4;Cube.viewport.update({x:Cube.viewport.posVector.x+parseInt((Cube.viewCenter.y-t.y)/r),y:Cube.viewport.posVector.y-parseInt((Cube.viewCenter.x-t.x)/r)})}),Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)};